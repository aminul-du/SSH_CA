
ğŸ” SSH Certificate Authority (SSH-CA) LAB
Ubuntu 22.04 LTS â€“ VirtualBox â€“ Manual Commands
ğŸ§± LAB IP PLAN (FIXED)
Role
VM Name
IP
CA Server
ssh-ca-01
10.10.100.100
Target Host
ssh-host-01
10.10.100.101
Client
ssh-client-01
10.10.100.102
Username (all)
aminulpmics
â€”


ğŸŸ¢ SLIDE 1 â€” BASE OS PREP (ALL VMs)
sudo apt update && sudo apt -y upgrade
sudo apt -y install openssh-server
sudo systemctl enable ssh
sudo systemctl start ssh

Create common user:
sudo useradd -m -s /bin/bash aminulpmics
sudo passwd aminulpmics
sudo usermod -aG sudo aminulpmics


ğŸŸ¢ SLIDE 2 â€” NETWORK CONFIG (ALL VMs)
Disable cloud-init networking
sudo mkdir -p /etc/cloud/cloud.cfg.d
echo "network: {config: disabled}" | sudo tee /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg


ğŸ”¹ CA SERVER (ssh-ca-01)
sudo tee /etc/netplan/01-ca.yaml <<EOF
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      dhcp4: true
    enp0s8:
      dhcp4: false
      addresses:
        - 10.10.100.100/24
EOF

sudo chmod 600 /etc/netplan/01-ca.yaml
sudo netplan apply


ğŸ”¹ TARGET HOST (ssh-host-01)
sudo tee /etc/netplan/01-host.yaml <<EOF
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      dhcp4: true
    enp0s8:
      dhcp4: false
      addresses:
        - 10.10.100.101/24
EOF

sudo chmod 600 /etc/netplan/01-host.yaml
sudo netplan apply


ğŸ”¹ CLIENT (ssh-client-01)
sudo tee /etc/netplan/01-client.yaml <<EOF
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      dhcp4: true
    enp0s8:
      dhcp4: false
      addresses:
        - 10.10.100.102/24
EOF

sudo chmod 600 /etc/netplan/01-client.yaml
sudo netplan apply


ğŸŸ¢ SLIDE 3 â€” SSH CA CREATION (CA SERVER)
sudo mkdir -p /etc/ssh/ca
cd /etc/ssh/ca
sudo ssh-keygen -t ed25519 -f ssh_user_ca -C "SSH User CA"
sudo ssh-keygen -t ed25519 -f ssh_host_ca -C "SSH Host CA"
sudo chmod 600 ssh_*_ca


ğŸŸ¢ SLIDE 4 â€” USER KEY (CLIENT)
ssh-keygen -t ed25519 -f ~/.ssh/aminulpmics_key -C "aminulpmics-user"

Copy public key to CA:
scp ~/.ssh/aminulpmics_key.pub aminulpmics@10.10.100.100:/tmp/


ğŸŸ¢ SLIDE 5 â€” SIGN USER CERT (CA SERVER)
sudo ssh-keygen -s /etc/ssh/ca/ssh_user_ca \
  -I aminulpmics-user-cert \
  -n aminulpmics \
  -V +7d \
  /tmp/aminulpmics_key.pub

Return cert to client:
scp /tmp/aminulpmics_key-cert.pub aminulpmics@10.10.100.102:~/.ssh/


ğŸŸ¢ SLIDE 6 â€” HOST KEY & CERT (TARGET HOST)
sudo ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""

Copy public key to CA:
scp /etc/ssh/ssh_host_ed25519_key.pub aminulpmics@10.10.100.100:/tmp/ssh-host.pub


ğŸŸ¢ SLIDE 7 â€” SIGN HOST CERT (CA SERVER)
sudo ssh-keygen -s /etc/ssh/ca/ssh_host_ca \
  -I ssh-host-01 \
  -h \
  -n ssh-host-01,10.10.100.101 \
  -V +52w \
  /tmp/ssh-host.pub

Send cert back:
scp /tmp/ssh-host-cert.pub aminulpmics@10.10.100.101:/tmp/


ğŸŸ¢ SLIDE 8 â€” CONFIGURE SSHD (TARGET HOST)
sudo mv /tmp/ssh-host-cert.pub /etc/ssh/

Edit SSH config:
sudo tee -a /etc/ssh/sshd_config <<EOF

TrustedUserCAKeys /etc/ssh/ssh_user_ca.pub
HostCertificate /etc/ssh/ssh-host-cert.pub
EOF

Copy CA public key:
scp aminulpmics@10.10.100.100:/etc/ssh/ca/ssh_user_ca.pub /etc/ssh/

Restart SSH:
sudo systemctl restart ssh


ğŸŸ¢ SLIDE 9 â€” CLIENT SSH CONFIG
tee ~/.ssh/config <<EOF
Host ssh-host-01
    HostName 10.10.100.101
    User aminulpmics
    IdentityFile ~/.ssh/aminulpmics_key
    CertificateFile ~/.ssh/aminulpmics_key-cert.pub
EOF

chmod 600 ~/.ssh/config


ğŸŸ¢ SLIDE 10 â€” LOGIN TEST
ssh ssh-host-01

âœ… Passwordless
âœ… No authorized_keys
âœ… Certificate-based trust

ğŸŸ¢ SLIDE 11 â€” VERIFY CERTS
ssh-keygen -L -f ~/.ssh/aminulpmics_key-cert.pub
ssh-keygen -L -f /etc/ssh/ssh-host-cert.pub


ğŸŸ¢ SLIDE 12 â€” SECURITY BENEFITS (ONE SLIDE)
âœ” No static keys
âœ” Central revocation
âœ” Short-lived access
âœ” Scales to thousands of servers
âœ” Enterprise-grade SSH security


